
<div class="row carts-index">
	<div class="col-md-12">
		<div class="container">
			<div class="card">
				<h2>购物车</h2>
				<div class="cart-header">

				<%= link_to("清空购物车", cart_items_clean_carts_path, method: :delete, class: "btn btn-danger pull-right") %>
				</div>
				<br>
				<br>
				<div class="cart-card">
						<%= render "cart" %>
				</div>

			</div>

		</div>

	</div>
</div>

<script>
	$(document).on('turbolinks:load', function(){
		//购物车全选
		cartSelectAll();
		//购物车勾选
		cartItemSelect();

	});
	//购物车全选
	function cartSelectAll(){
		$(".cart-select-all").click(function(){

			var flag = this.checked
			var items = document.getElementsByName('item_ids[]');
			for (var i = 0; i < items.length; i++) {
				items[i].checked = flag;
			}
			//重新计算总价
			totalPrice();
		})
	}

	//购物车勾选
	function cartItemSelect(){
			var items = document.getElementsByName('item_ids[]');
			for (var i = 0; i < items.length; i++) {
				items[i].onclick = function(){
					//记录有几个商品被选中
					var num = 0;
					for (var j = 0; j < items.length; j++) {
						if (items[j].checked){
							num++;
						}
					}
					$(".cart-select-all").prop("checked", items.length == num);
					totalPrice();
				}
			}
	}

	//计算总价
	function totalPrice(){
		var totalprice = 0;
		var items = document.getElementsByName('item_ids[]');
		for (var i = 0; i < items.length; i++) {
			if (items[i].checked) {
				totalprice += parseInt($("#item-price-" + i).html());
			}
		}
		$(".total-price").html(totalprice);
	}

</script>
